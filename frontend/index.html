<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outreach Intelligence — Email SaaS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">Outreach</h1>
                <p class="logo-sub">Email automation</p>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" onclick="navigateTo('dashboard')">
                    <i data-lucide="layout-dashboard" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#leads" class="nav-item" onclick="navigateTo('leads')">
                    <i data-lucide="users" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Leads</span>
                </a>
                <a href="#analytics" class="nav-item" onclick="navigateTo('analytics')">
                    <i data-lucide="bar-chart-2" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Analytics</span>
                </a>
                <a href="#reports" class="nav-item" onclick="navigateTo('reports')">
                    <i data-lucide="file-text" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="#logs" class="nav-item" onclick="navigateTo('logs')">
                    <i data-lucide="scroll-text" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Logs</span>
                </a>
                <a href="#templates" class="nav-item" onclick="navigateTo('templates')">
                    <i data-lucide="mail" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Templates</span>
                </a>
                <a href="#settings" class="nav-item" onclick="navigateTo('settings')">
                    <i data-lucide="settings" class="nav-icon" aria-hidden="true"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <p class="subtitle">Your dedicated 24/7 outreach engine</p>
                </div>

                <!-- Metrics Cards -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">SENT TODAY:</div>
                        <div class="metric-value" id="sentToday">0 / 500</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">REPLIES:</div>
                        <div class="metric-value" id="replies">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">FAILED:</div>
                        <div class="metric-value" id="failed">0</div>
                    </div>
                    <div class="metric-card status-card">
                        <div class="metric-label">CAMPAIGN STATUS</div>
                        <div class="status-badge" id="campaignStatus">Stopped</div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-section">
                    <div class="progress-header">
                        <span>Daily Progress</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Command Center -->
                <div class="command-section">
                    <h2>Campaign</h2>
                    <div class="button-grid">
                        <button type="button" class="btn btn-start" onclick="startCampaign()">
                            <i data-lucide="play" class="btn-icon" aria-hidden="true"></i> Start
                        </button>
                        <button type="button" class="btn btn-pause" onclick="pauseCampaign()">
                            <i data-lucide="pause" class="btn-icon" aria-hidden="true"></i> Pause
                        </button>
                        <button type="button" class="btn btn-stop" onclick="stopCampaign()">
                            <i data-lucide="square" class="btn-icon" aria-hidden="true"></i> Stop
                        </button>
                    </div>
                </div>

                <!-- Upload Leads -->
                <div class="upload-section">
                    <h2>Upload leads</h2>
                    <div class="upload-box">
                        <div class="upload-area" id="uploadArea">
                            <i data-lucide="folder-up" class="upload-icon" aria-hidden="true"></i>
                            <p>Drag and drop CSV here, or click to browse</p>
                            <input type="file" id="csvFile" accept=".csv" style="display: none;">
                            <p class="upload-hint" id="uploadHint"></p>
                        </div>
                        <button type="button" class="btn btn-upload" onclick="uploadLeads()">
                            <i data-lucide="upload" class="btn-icon" aria-hidden="true"></i> Upload CSV
                        </button>
                    </div>
                </div>

                <!-- Replied / Meetings pipeline -->
                <div class="pipeline-section">
                    <h2>Replied and meeting pipeline</h2>
                    <p class="section-desc">Leads who replied; calendar link is sent automatically</p>
                    <div class="pipeline-stats">
                        <div class="pipeline-stat">
                            <span class="pipeline-value" id="repliedCount">0</span>
                            <span class="pipeline-label">Total replied</span>
                        </div>
                        <a href="#leads" class="pipeline-link" onclick="navigateTo('leads'); setTimeout(() => filterLeads('replied'), 100);">View replied leads →</a>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="logs-section">
                    <h2>Recent activity</h2>
                    <div id="dashboardLogsContainer" class="logs-container"></div>
                </div>
            </div>

            <!-- Leads Page -->
            <div id="leads-page" class="page">
                <div class="page-header">
                    <h1>Lead Management</h1>
                    <p class="subtitle">Manage all your leads in one place</p>
                </div>

                <!-- Controls -->
                <div class="leads-controls">
                    <input type="text" id="leadSearch" class="search-input"
                        placeholder="Search by email, name, or company..." oninput="searchLeads()">

                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="filterLeads('all')">All</button>
                        <button class="filter-tab" onclick="filterLeads('pending')">Pending</button>
                        <button class="filter-tab" onclick="filterLeads('sent')">Sent</button>
                        <button class="filter-tab" onclick="filterLeads('replied')">Replied</button>
                        <button class="filter-tab" onclick="filterLeads('failed')">Failed</button>
                    </div>
                </div>

                <!-- Leads Table -->
                <div class="table-container">
                    <table id="leadsTable" class="leads-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                <th onclick="sortLeads('email')">Email ↕</th>
                                <th>Name</th>
                                <th>Company</th>
                                <th onclick="sortLeads('status')">Status ↕</th>
                                <th onclick="sortLeads('last_sent_at')">Last Sent ↕</th>
                                <th>Follow-ups</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTableBody">
                            <tr>
                                <td colspan="8" class="no-data">Loading leads...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="leadsPagination"></div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics-page" class="page">
                <div class="page-header">
                    <h1>Analytics</h1>
                    <p class="subtitle">Insights and performance over time</p>
                </div>

                <div class="date-range-bar">
                    <label>Date range</label>
                    <input type="date" id="analyticsDateFrom" class="input-field date-input">
                    <span class="date-sep">→</span>
                    <input type="date" id="analyticsDateTo" class="input-field date-input">
                    <button type="button" class="btn btn-secondary" onclick="applyAnalyticsDateRange()">Apply</button>
                </div>

                <!-- Stats Summary -->
                <div class="analytics-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Leads</div>
                        <div class="stat-value" id="analyticsTotal">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Reply Rate</div>
                        <div class="stat-value" id="analyticsReplyRate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Failure Rate</div>
                        <div class="stat-value" id="analyticsFailureRate">0%</div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Emails Sent Over Time</h3>
                        <canvas id="timelineChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Lead Status Distribution</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-page" class="page">
                <div class="page-header">
                    <h1>Reports</h1>
                    <p class="subtitle">Daily analytics report — preview and send</p>
                </div>
                <div class="reports-actions">
                    <button type="button" class="btn btn-primary" onclick="previewReport()">Preview report</button>
                    <button type="button" class="btn btn-success" onclick="sendReportNow()">Send report now</button>
                </div>
                <div id="reportPreviewCard" class="report-preview-card" style="display: none;">
                    <h3>Report preview</h3>
                    <div id="reportPreviewContent" class="report-preview-content"></div>
                </div>
            </div>

            <!-- Logs Page -->
            <div id="logs-page" class="page">
                <div class="page-header">
                    <h1>Logs</h1>
                    <p class="subtitle">Full activity and event log</p>
                </div>
                <div class="logs-controls">
                    <input type="text" id="logsSearch" class="search-input" placeholder="Search by event or email..." oninput="debounceSearchLogs()">
                    <span class="logs-meta" id="logsMeta">—</span>
                </div>
                <div class="table-container">
                    <table class="leads-table logs-table">
                        <thead>
                            <tr>
                                <th>Time (UTC)</th>
                                <th>Email</th>
                                <th>Event</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <tr><td colspan="3" class="no-data">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="logsPagination"></div>
            </div>

            <!-- Templates Page -->
            <div id="templates-page" class="page">
                <div class="page-header">
                    <h1>Email Templates</h1>
                    <p class="subtitle">Customize your outreach messages</p>
                </div>

                <!-- Available Variables -->
                <div class="variables-section">
                    <h3>Available Variables (click to insert)</h3>
                    <div id="variablesContainer" class="variables-tags">
                        <p class="no-data">Upload CSV to see available columns</p>
                    </div>
                </div>

                <!-- Template Grid -->
                <div class="template-grid">
                    <!-- Initial Email -->
                    <div class="template-column">
                        <h3>Initial email</h3>
                        <label>Subject</label>
                        <input type="text" id="initialSubject" class="input-field" placeholder="Enter subject">
                        <label>Body</label>
                        <div id="initialVariables" class="inline-variables"></div>
                        <textarea id="initialBody" class="textarea-field" rows="6"
                            placeholder="Email body. Use {{column_name}} for variables."></textarea>
                    </div>

                    <!-- Follow-up 1 -->
                    <div class="template-column">
                        <h3>Follow-up 1 (after 3 days)</h3>
                        <label>Subject</label>
                        <input type="text" id="followup1Subject" class="input-field" placeholder="Enter subject">
                        <label>Body</label>
                        <div id="followup1Variables" class="inline-variables"></div>
                        <textarea id="followup1Body" class="textarea-field" rows="6"
                            placeholder="First follow-up body"></textarea>
                    </div>

                    <!-- Follow-up 2 -->
                    <div class="template-column">
                        <h3>Follow-up 2 (after 6 days)</h3>
                        <label>Subject</label>
                        <input type="text" id="followup2Subject" class="input-field" placeholder="Enter subject">
                        <label>Body</label>
                        <div id="followup2Variables" class="inline-variables"></div>
                        <textarea id="followup2Body" class="textarea-field" rows="6"
                            placeholder="Second follow-up body"></textarea>
                    </div>

                    <!-- Auto-Reply Template -->
                    <div class="template-column">
                        <h3>Auto-reply (when they respond)</h3>
                        <label>Subject</label>
                        <input type="text" id="replySubject" class="input-field" placeholder="Enter subject">
                        <label>Body</label>
                        <div id="replyVariables" class="inline-variables"></div>
                        <textarea id="replyBody" class="textarea-field" rows="6"
                            placeholder="Auto-reply with calendar link. Use {{calendar_link}} for your calendar."></textarea>
                        <p class="template-hint">Available: {{first_name}}, {{company}}, {{calendar_link}}, {{email}}, and any CSV columns</p>
                    </div>
                </div>

                <button type="button" class="btn btn-save" onclick="saveTemplates()">
                    <i data-lucide="save" class="btn-icon" aria-hidden="true"></i> Save templates
                </button>
            </div>

            <!-- Settings Page (all config here; no .env required) -->
            <div id="settings-page" class="page">
                <div class="page-header">
                    <h1>Settings</h1>
                    <p class="subtitle">Configure license, sending limits, and email accounts</p>
                </div>

                <form id="settings-form" class="settings-form" onsubmit="return saveAppSettings(event)">
                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3>License</h3>
                            <div class="setting-item">
                                <label>License sheet URL</label>
                                <input type="url" id="settingsLicenseSheetUrl" class="input-field" placeholder="https://docs.google.com/.../export?format=csv">
                            </div>
                            <div class="setting-item">
                                <label>License key</label>
                                <input type="text" id="settingsLicenseKey" class="input-field" placeholder="Your license key">
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3>Sending</h3>
                            <div class="setting-item">
                                <label>Daily email limit</label>
                                <input type="number" id="settingsDailyLimit" class="input-field" min="1" placeholder="500">
                            </div>
                            <div class="setting-item">
                                <label>Delay between emails (min–max seconds)</label>
                                <div class="input-row">
                                    <input type="number" id="settingsMinDelay" class="input-field" min="1" placeholder="60">
                                    <span class="input-sep">–</span>
                                    <input type="number" id="settingsMaxDelay" class="input-field" min="1" placeholder="120">
                                </div>
                            </div>
                            <div class="setting-item">
                                <label>Pause every N emails (longer break)</label>
                                <input type="number" id="settingsPauseEvery" class="input-field" min="1" placeholder="20">
                            </div>
                            <div class="setting-item">
                                <label>Pause duration (min–max minutes)</label>
                                <div class="input-row">
                                    <input type="number" id="settingsPauseMin" class="input-field" min="0" placeholder="5">
                                    <span class="input-sep">–</span>
                                    <input type="number" id="settingsPauseMax" class="input-field" min="0" placeholder="8">
                                </div>
                            </div>
                        </div>
                        <div class="settings-card settings-card-full">
                            <h3>Calendar link</h3>
                            <div class="setting-item">
                                <label>URL for booking (e.g. Calendly)</label>
                                <input type="url" id="settingsCalendarLink" class="input-field" placeholder="https://calendly.com/your-link">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i data-lucide="save" class="btn-icon" aria-hidden="true"></i> Save settings
                    </button>
                </form>

                <div class="email-accounts-section">
                    <h2>Email accounts</h2>
                    <p class="section-desc">Add one or more SMTP/IMAP accounts. Sending is distributed across them.</p>
                    <div id="emailAccountsList" class="email-accounts-list"></div>
                    <div class="email-account-add-card">
                        <h3>Add account</h3>
                        <div class="add-account-form">
                            <div class="setting-item">
                                <label>Label</label>
                                <input type="text" id="newAccountLabel" class="input-field" placeholder="e.g. Sales Gmail">
                            </div>
                            <div class="setting-item">
                                <label>Email</label>
                                <input type="email" id="newAccountEmail" class="input-field" placeholder="you@gmail.com">
                            </div>
                            <div class="setting-item">
                                <label>App password</label>
                                <input type="password" id="newAccountPassword" class="input-field" placeholder="App password (not regular password)">
                            </div>
                            <div class="setting-item">
                                <label>SMTP server / port</label>
                                <div class="input-row">
                                    <input type="text" id="newAccountSmtpServer" class="input-field" value="smtp.gmail.com" placeholder="smtp.gmail.com">
                                    <input type="number" id="newAccountSmtpPort" class="input-field input-narrow" value="587" placeholder="587">
                                </div>
                            </div>
                            <div class="setting-item">
                                <label>IMAP server / port</label>
                                <div class="input-row">
                                    <input type="text" id="newAccountImapServer" class="input-field" value="imap.gmail.com" placeholder="imap.gmail.com">
                                    <input type="number" id="newAccountImapPort" class="input-field input-narrow" value="993" placeholder="993">
                                </div>
                            </div>
                            <div class="setting-item setting-actions">
                                <button type="button" class="btn btn-secondary" onclick="testNewAccountConnection()">
                                    <i data-lucide="plug" class="btn-icon" aria-hidden="true"></i> Test connection
                                </button>
                                <span id="newAccountTestResult" class="test-result"></span>
                            </div>
                            <button type="button" class="btn btn-success" onclick="addEmailAccount()">
                                <i data-lucide="plus" class="btn-icon" aria-hidden="true"></i> Add account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>